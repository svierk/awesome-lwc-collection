<template>
  <template lwc:if={isLoading}>
    <lightning-spinner alternative-text="Loading" variant="brand"></lightning-spinner>
  </template>
  <template lwc:if={isUsedAsRelatedList}>
    <div class="slds-page-header slds-page-header_record-home page-header">
      <div class="slds-page-header__row">
        <div class="slds-page-header__col-title">
          <div class="slds-media">
            <div class="slds-media__figure">
              <span class="slds-icon_container">
                <lightning-icon
                  icon-name={cardIcon}
                  alternative-text={cardTitle}
                  title={cardTitle}
                  size="small"
                ></lightning-icon>
              </span>
            </div>
            <div class="slds-media__body">
              <h2 class="slds-card__header-title">{cardTitle}</h2>
            </div>
          </div>
        </div>

        <div class="slds-page-header__col-actions">
          <div class="slds-page-header__controls">
            <div class="slds-page-header__control">
              <template lwc:if={showMultipleRowDeleteAction}>
                <lightning-button
                  lwc:if={hasSelectedRecords}
                  label="Delete"
                  onclick={deleteSelectedRecords}
                ></lightning-button>
              </template>
            </div>
          </div>
        </div>
      </div>

      <div class="slds-page-header__row slds-page-header__row_gutters">
        <div class="slds-page-header__col-details">
          <template lwc:if={showPagination}>
            <p class="slds-text-body_small slds-m-bottom_xx-small record-count-text">{recordCountLabel}</p>
          </template>
          <ul class="slds-page-header__detail-row slds-p-around_none page-header-detail">
            <c-custom-datatable-extension
              key-field={keyField}
              data={records}
              columns={columns}
              column-widths-mode={columnWidthsMode}
              default-sort-direction={defaultSortDirection}
              draft-values={draftValues}
              hide-checkbox-column={hideCheckboxColumn}
              hide-table-header={hideTableHeader}
              max-column-width={maxColumnWidth}
              max-row-selection={maxRowSelection}
              min-column-width={minColumnWidth}
              row-number-offset={computedRowNumberOffset}
              resize-column-disabled={resizeColumnDisabled}
              show-row-number-column={showRowNumberColumn}
              suppress-bottom-bar={suppressBottomBar}
              onrowaction={handleRowAction}
              onrowselection={getSelectedRecords}
              onsave={handleSave}
            >
            </c-custom-datatable-extension>
          </ul>
          <template lwc:if={showPagination}>
            <div class="slds-grid slds-grid_align-center slds-m-top_small">
              <lightning-button
                label="First"
                icon-name="utility:jump_to_left"
                onclick={handleFirst}
                disabled={isFirstPage}
                class="slds-m-right_xx-small"
              ></lightning-button>
              <lightning-button
                label="Previous"
                icon-name="utility:chevronleft"
                onclick={handlePrevious}
                disabled={isFirstPage}
                class="slds-m-right_xx-small"
              ></lightning-button>
              <span class="slds-align-middle slds-p-horizontal_small slds-text-body_small"> {paginationLabel} </span>
              <lightning-button
                label="Next"
                icon-name="utility:chevronright"
                icon-position="right"
                onclick={handleNext}
                disabled={isLastPage}
                class="slds-m-left_xx-small"
              ></lightning-button>
              <lightning-button
                label="Last"
                icon-name="utility:jump_to_right"
                icon-position="right"
                onclick={handleLast}
                disabled={isLastPage}
                class="slds-m-left_xx-small"
              ></lightning-button>
            </div>
          </template>
        </div>
      </div>
    </div>
  </template>
  <template lwc:elseif={showCard}>
    <lightning-card title={cardTitle} icon-name={cardIcon}>
      <template lwc:if={showMultipleRowDeleteAction}>
        <lightning-button
          lwc:if={hasSelectedRecords}
          label="Delete"
          slot="actions"
          onclick={deleteSelectedRecords}
        ></lightning-button>
      </template>
      <template lwc:if={showPagination}>
        <p class="slds-text-body_small slds-m-bottom_xx-small slds-p-horizontal_medium record-count-text">
          {recordCountLabel}
        </p>
      </template>
      <c-custom-datatable-extension
        key-field={keyField}
        data={records}
        columns={columns}
        column-widths-mode={columnWidthsMode}
        default-sort-direction={defaultSortDirection}
        draft-values={draftValues}
        hide-checkbox-column={hideCheckboxColumn}
        hide-table-header={hideTableHeader}
        max-column-width={maxColumnWidth}
        max-row-selection={maxRowSelection}
        min-column-width={minColumnWidth}
        row-number-offset={computedRowNumberOffset}
        resize-column-disabled={resizeColumnDisabled}
        show-row-number-column={showRowNumberColumn}
        suppress-bottom-bar={suppressBottomBar}
        onrowaction={handleRowAction}
        onrowselection={getSelectedRecords}
        onsave={handleSave}
      >
      </c-custom-datatable-extension>
      <template lwc:if={showPagination}>
        <div class="slds-grid slds-grid_align-center slds-m-top_small">
          <lightning-button
            label="First"
            icon-name="utility:jump_to_left"
            onclick={handleFirst}
            disabled={isFirstPage}
            class="slds-m-right_xx-small"
          ></lightning-button>
          <lightning-button
            label="Previous"
            icon-name="utility:chevronleft"
            onclick={handlePrevious}
            disabled={isFirstPage}
            class="slds-m-right_xx-small"
          ></lightning-button>
          <span class="slds-align-middle slds-p-horizontal_small slds-text-body_small"> {paginationLabel} </span>
          <lightning-button
            label="Next"
            icon-name="utility:chevronright"
            icon-position="right"
            onclick={handleNext}
            disabled={isLastPage}
            class="slds-m-left_xx-small"
          ></lightning-button>
          <lightning-button
            label="Last"
            icon-name="utility:jump_to_right"
            icon-position="right"
            onclick={handleLast}
            disabled={isLastPage}
            class="slds-m-left_xx-small"
          ></lightning-button>
        </div>
      </template>
    </lightning-card>
  </template>
  <template lwc:else>
    <template lwc:if={showPagination}>
      <p class="slds-text-body_small slds-m-bottom_xx-small record-count-text">{recordCountLabel}</p>
    </template>
    <c-custom-datatable-extension
      key-field={keyField}
      data={records}
      columns={columns}
      column-widths-mode={columnWidthsMode}
      default-sort-direction={defaultSortDirection}
      draft-values={draftValues}
      hide-checkbox-column={hideCheckboxColumn}
      hide-table-header={hideTableHeader}
      max-column-width={maxColumnWidth}
      max-row-selection={maxRowSelection}
      min-column-width={minColumnWidth}
      row-number-offset={computedRowNumberOffset}
      resize-column-disabled={resizeColumnDisabled}
      show-row-number-column={showRowNumberColumn}
      suppress-bottom-bar={suppressBottomBar}
      onrowaction={handleRowAction}
      onrowselection={getSelectedRecords}
      onsave={handleSave}
    >
    </c-custom-datatable-extension>
    <template lwc:if={showPagination}>
      <div class="slds-grid slds-grid_align-center slds-m-top_small">
        <lightning-button
          label="First"
          icon-name="utility:jump_to_left"
          onclick={handleFirst}
          disabled={isFirstPage}
          class="slds-m-right_xx-small"
        ></lightning-button>
        <lightning-button
          label="Previous"
          icon-name="utility:chevronleft"
          onclick={handlePrevious}
          disabled={isFirstPage}
          class="slds-m-right_xx-small"
        ></lightning-button>
        <span class="slds-align-middle slds-p-horizontal_small slds-text-body_small"> {paginationLabel} </span>
        <lightning-button
          label="Next"
          icon-name="utility:chevronright"
          icon-position="right"
          onclick={handleNext}
          disabled={isLastPage}
          class="slds-m-left_xx-small"
        ></lightning-button>
        <lightning-button
          label="Last"
          icon-name="utility:jump_to_right"
          icon-position="right"
          onclick={handleLast}
          disabled={isLastPage}
          class="slds-m-left_xx-small"
        ></lightning-button>
      </div>
    </template>
  </template>
</template>
